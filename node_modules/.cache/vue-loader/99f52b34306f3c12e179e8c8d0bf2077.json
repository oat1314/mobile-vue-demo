{"remainingRequest":"F:\\BaiduNetdiskDownload\\思否\\20年spring boot+vue课程源码\\课程源码\\00-前端-后端代码-数据库\\xdclass_front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\BaiduNetdiskDownload\\思否\\20年spring boot+vue课程源码\\课程源码\\00-前端-后端代码-数据库\\xdclass_front\\node_modules\\cube-ui\\src\\components\\validator\\validator.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\BaiduNetdiskDownload\\思否\\20年spring boot+vue课程源码\\课程源码\\00-前端-后端代码-数据库\\xdclass_front\\node_modules\\cube-ui\\src\\components\\validator\\validator.vue","mtime":499162500000},{"path":"F:\\BaiduNetdiskDownload\\思否\\20年spring boot+vue课程源码\\课程源码\\00-前端-后端代码-数据库\\xdclass_front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\BaiduNetdiskDownload\\思否\\20年spring boot+vue课程源码\\课程源码\\00-前端-后端代码-数据库\\xdclass_front\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"F:\\BaiduNetdiskDownload\\思否\\20年spring boot+vue课程源码\\课程源码\\00-前端-后端代码-数据库\\xdclass_front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\BaiduNetdiskDownload\\思否\\20年spring boot+vue课程源码\\课程源码\\00-前端-后端代码-数据库\\xdclass_front\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IHBhcmFsbGVsLCBjYjJQcm9taXNlV2l0aFJlc29sdmUsIGlzVW5kZWYsIGlzRnVuYywgaXNTdHJpbmcsIGlzQXJyYXkgfSBmcm9tICcuLi8uLi9jb21tb24vaGVscGVycy91dGlsJwppbXBvcnQgeyBydWxlcyB9IGZyb20gJy4uLy4uL2NvbW1vbi9oZWxwZXJzL3ZhbGlkYXRvcicKaW1wb3J0IGxvY2FsZU1peGluIGZyb20gJy4uLy4uL2NvbW1vbi9taXhpbnMvbG9jYWxlJwppbXBvcnQgdGVtcGxhdGUgZnJvbSAnLi4vLi4vY29tbW9uL2hlbHBlcnMvc3RyaW5nLXRlbXBsYXRlJwoKY29uc3QgQ09NUE9ORU5UX05BTUUgPSAnY3ViZS12YWxpZGF0b3InCmNvbnN0IEVWRU5UX0lOUFVUID0gJ2lucHV0Jwpjb25zdCBFVkVOVF9WQUxJREFUSU5HID0gJ3ZhbGlkYXRpbmcnCmNvbnN0IEVWRU5UX1ZBTElEQVRFRCA9ICd2YWxpZGF0ZWQnCmNvbnN0IEVWRU5UX01TR19DTElDSyA9ICdtc2ctY2xpY2snCgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogQ09NUE9ORU5UX05BTUUsCiAgbWl4aW5zOiBbbG9jYWxlTWl4aW5dLAogIHByb3BzOiB7CiAgICBtb2RlbDogewogICAgICByZXF1aXJlZDogdHJ1ZQogICAgfSwKICAgIG1vZGVsS2V5OiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogJycKICAgIH0sCiAgICBydWxlczogewogICAgICB0eXBlOiBPYmplY3QsCiAgICAgIGRlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuIHt9CiAgICAgIH0KICAgIH0sCiAgICBtZXNzYWdlczogewogICAgICB0eXBlOiBbT2JqZWN0LCBTdHJpbmddLAogICAgICBkZWZhdWx0KCkgewogICAgICAgIHJldHVybiB7fQogICAgICB9CiAgICB9LAogICAgdmFsdWU6IHt9LAogICAgZGlzYWJsZWQ6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICBpbW1lZGlhdGU6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0KICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB2YWxpZDogdGhpcy52YWx1ZSwKICAgICAgdmFsaWRhdGVkOiBmYWxzZSwKICAgICAgbXNnOiAnJywKICAgICAgZGlydHk6IGZhbHNlLAogICAgICB2YWxpZGF0aW5nOiBmYWxzZSwKICAgICAgcmVzdWx0OiB7fQogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHRhcmdldE1vZGVsKCkgewogICAgICBjb25zdCBtb2RlbEtleSA9IHRoaXMubW9kZWxLZXkKICAgICAgY29uc3QgbW9kZWwgPSB0aGlzLm1vZGVsCiAgICAgIHJldHVybiBtb2RlbEtleSA/IG1vZGVsW21vZGVsS2V5XSA6IG1vZGVsCiAgICB9LAogICAgaW52YWxpZCgpIHsKICAgICAgY29uc3QgdmFsaWQgPSB0aGlzLnZhbGlkCiAgICAgIHJldHVybiBpc1VuZGVmKHZhbGlkKSA/IHVuZGVmaW5lZCA6ICF2YWxpZAogICAgfSwKICAgIGlzRGlzYWJsZWQoKSB7CiAgICAgIGNvbnN0IGRpc2FibGVkID0gdGhpcy5kaXNhYmxlZAogICAgICBjb25zdCBub1J1bGVzID0gT2JqZWN0LmtleXModGhpcy5ydWxlcykubGVuZ3RoIDw9IDAKICAgICAgcmV0dXJuIGRpc2FibGVkIHx8IG5vUnVsZXMKICAgIH0sCiAgICBkaXJ0eU9yVmFsaWRhdGVkKCkgewogICAgICByZXR1cm4gKHRoaXMuZGlydHkgfHwgdGhpcy52YWxpZGF0ZWQpICYmICF0aGlzLnZhbGlkYXRpbmcKICAgIH0sCiAgICBjb250YWluZXJDbGFzcygpIHsKICAgICAgY29uc3QgZGlzYWJsZWQgPSB0aGlzLmlzRGlzYWJsZWQKICAgICAgaWYgKGRpc2FibGVkKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICAnY3ViZS12YWxpZGF0b3JfaW52YWxpZCc6IHRoaXMuaW52YWxpZCwKICAgICAgICAnY3ViZS12YWxpZGF0b3JfdmFsaWQnOiB0aGlzLnZhbGlkLAogICAgICAgICdjdWJlLXZhbGlkYXRvcl92YWxpZGF0aW5nJzogdGhpcy52YWxpZGF0aW5nCiAgICAgIH0KICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICB2YWx1ZShuZXdWYWwpIHsKICAgICAgdGhpcy52YWxpZCA9IG5ld1ZhbAogICAgfSwKICAgIHRhcmdldE1vZGVsOiB7CiAgICAgIGhhbmRsZXIoKSB7CiAgICAgICAgaWYgKHRoaXMuaXNEaXNhYmxlZCkgewogICAgICAgICAgcmV0dXJuCiAgICAgICAgfQogICAgICAgIGlmICghdGhpcy5kaXJ0eSkgewogICAgICAgICAgdGhpcy5kaXJ0eSA9IHRydWUKICAgICAgICB9CgogICAgICAgIHRoaXMudmFsaWRhdGUoKQogICAgICB9LAogICAgICBzeW5jOiB0cnVlCiAgICB9LAogICAgcnVsZXMoKSB7CiAgICAgIHRoaXMudmFsaWRhdGUoKQogICAgfSwKICAgIGlzRGlzYWJsZWQobmV3VmFsKSB7CiAgICAgIGlmICghbmV3VmFsICYmIHRoaXMudHJpZ2dlciAmJiAhdGhpcy52YWxpZGF0ZWQpIHsKICAgICAgICB0aGlzLnZhbGlkYXRlKCkKICAgICAgfQogICAgfQogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuX3ZhbGlkYXRlQ291bnQgPSAwCiAgICBpZiAoIXRoaXMuaXNEaXNhYmxlZCAmJiB0aGlzLmltbWVkaWF0ZSkgewogICAgICB0aGlzLnZhbGlkYXRlKCkKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIHZhbGlkYXRlKGNiKSB7CiAgICAgIGNvbnN0IHByb21pc2UgPSBjYjJQcm9taXNlV2l0aFJlc29sdmUoY2IpCiAgICAgIGlmIChwcm9taXNlKSB7CiAgICAgICAgY2IgPSBwcm9taXNlLnJlc29sdmUKICAgICAgfQogICAgICBpZiAodGhpcy5pc0Rpc2FibGVkKSB7CiAgICAgICAgY2IgJiYgY2IodGhpcy52YWxpZCkKICAgICAgICByZXR1cm4gcHJvbWlzZQogICAgICB9CiAgICAgIHRoaXMuX3ZhbGlkYXRlQ291bnQrKwogICAgICBjb25zdCB2YWxpZGF0ZUNvdW50ID0gdGhpcy5fdmFsaWRhdGVDb3VudAogICAgICBjb25zdCB2YWwgPSB0aGlzLnRhcmdldE1vZGVsCgogICAgICBjb25zdCBjb25maWdSdWxlcyA9IHRoaXMucnVsZXMKICAgICAgY29uc3QgdHlwZSA9IGNvbmZpZ1J1bGVzLnR5cGUKICAgICAgY29uc3QgYWxsVGFza3MgPSBbXQoKICAgICAgbGV0IHJlcXVpcmVkVmFsaWQgPSB0cnVlCiAgICAgIGlmICghY29uZmlnUnVsZXMucmVxdWlyZWQpIHsKICAgICAgICAvLyB0cmVhdCBpdCBhcyBlbXB0eSwgbm8gbmVlZCB0byB2YWxpZGF0ZSBvdGhlciBydWxlcwogICAgICAgIHJlcXVpcmVkVmFsaWQgPSBydWxlcy5yZXF1aXJlZCh2YWwsIHRydWUsIHR5cGUpCiAgICAgIH0KCiAgICAgIGlmIChyZXF1aXJlZFZhbGlkKSB7CiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gY29uZmlnUnVsZXMpIHsKICAgICAgICAgIGNvbnN0IHJ1bGVWYWx1ZSA9IGNvbmZpZ1J1bGVzW2tleV0KICAgICAgICAgIGxldCByZXQKICAgICAgICAgIGlmIChpc0Z1bmMocnVsZVZhbHVlKSkgewogICAgICAgICAgICByZXQgPSBydWxlVmFsdWUodmFsLCBjb25maWdSdWxlc1trZXldLCB0eXBlKQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0ID0gIXJ1bGVzW2tleV0gfHwgcnVsZXNba2V5XSh2YWwsIGNvbmZpZ1J1bGVzW2tleV0sIHR5cGUpCiAgICAgICAgICB9CiAgICAgICAgICBhbGxUYXNrcy5wdXNoKChuZXh0KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmUgPSAoX3JldCkgPT4gewogICAgICAgICAgICAgIG5leHQoewogICAgICAgICAgICAgICAga2V5OiBrZXksCiAgICAgICAgICAgICAgICB2YWxpZDogX3JldCA9PT0gdHJ1ZSwKICAgICAgICAgICAgICAgIHJldDogX3JldAogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgcmVqZWN0ID0gKGVycikgPT4gewogICAgICAgICAgICAgIG5leHQoewogICAgICAgICAgICAgICAga2V5OiBrZXksCiAgICAgICAgICAgICAgICB2YWxpZDogZmFsc2UsCiAgICAgICAgICAgICAgICByZXQ6IGVycgogICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGVvZiByZXQgPT09ICdvYmplY3QnICYmIGlzRnVuYyhyZXQudGhlbikpIHsKICAgICAgICAgICAgICByZXQudGhlbihyZXNvbHZlKS5jYXRjaChyZWplY3QpCiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNGdW5jKHJldCkpIHsKICAgICAgICAgICAgICByZXQocmVzb2x2ZSwgcmVqZWN0KQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG5leHQoewogICAgICAgICAgICAgICAga2V5OiBrZXksCiAgICAgICAgICAgICAgICB2YWxpZDogcmV0ID09PSB0cnVlLAogICAgICAgICAgICAgICAgcmV0OiByZXQKICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLl9jaGVja1Rhc2tzKGFsbFRhc2tzLCB2YWxpZGF0ZUNvdW50LCBjYikKICAgICAgcmV0dXJuIHByb21pc2UKICAgIH0sCiAgICBfY2hlY2tUYXNrcyhhbGxUYXNrcywgdmFsaWRhdGVDb3VudCwgY2IpIHsKICAgICAgY29uc3QgY29uZmlnUnVsZXMgPSB0aGlzLnJ1bGVzCiAgICAgIGxldCBpc1ZhbGlkID0gdHJ1ZQogICAgICBjb25zdCByZXN1bHQgPSB7fQogICAgICBsZXQgc3luYyA9IHRydWUKICAgICAgdGhpcy52YWxpZGF0aW5nID0gdHJ1ZQogICAgICBjb25zdCBtb2RlbCA9IHRoaXMudGFyZ2V0TW9kZWwKICAgICAgcGFyYWxsZWwoYWxsVGFza3MsIChyZXN1bHRzKSA9PiB7CiAgICAgICAgaWYgKHRoaXMuX3ZhbGlkYXRlQ291bnQgIT09IHZhbGlkYXRlQ291bnQpIHsKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICB0aGlzLnZhbGlkYXRpbmcgPSBmYWxzZQogICAgICAgIHJlc3VsdHMuZm9yRWFjaCgoeyBrZXksIHZhbGlkLCByZXQgfSkgPT4gewogICAgICAgICAgY29uc3QgbXNnID0gdGhpcy5tZXNzYWdlc1trZXldCiAgICAgICAgICAgID8gaXNGdW5jKHRoaXMubWVzc2FnZXNba2V5XSkKICAgICAgICAgICAgICA/IHRoaXMubWVzc2FnZXNba2V5XShyZXQsIHZhbGlkKQogICAgICAgICAgICAgIDogdGhpcy5tZXNzYWdlc1trZXldCiAgICAgICAgICAgIDogdGhpcy5maW5kTWVzc2FnZShrZXksIGNvbmZpZ1J1bGVzW2tleV0sIGNvbmZpZ1J1bGVzLnR5cGUsIG1vZGVsKQogICAgICAgICAgaWYgKGlzVmFsaWQgJiYgIXZhbGlkKSB7CiAgICAgICAgICAgIGlzVmFsaWQgPSBmYWxzZQogICAgICAgICAgICB0aGlzLm1zZyA9IG1zZwogICAgICAgICAgfQogICAgICAgICAgcmVzdWx0W2tleV0gPSB7CiAgICAgICAgICAgIHZhbGlkOiB2YWxpZCwKICAgICAgICAgICAgaW52YWxpZDogIXZhbGlkLAogICAgICAgICAgICBtZXNzYWdlOiBtc2cKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIGlmICghc3luYykgewogICAgICAgICAgdGhpcy4kZW1pdChFVkVOVF9WQUxJREFURUQsIGlzVmFsaWQpCiAgICAgICAgfQogICAgICAgIHRoaXMuX3VwZGF0ZU1vZGVsKGlzVmFsaWQsIHJlc3VsdCkKICAgICAgICBjYiAmJiBjYih0aGlzLnZhbGlkKQogICAgICB9KQogICAgICBpZiAodGhpcy52YWxpZGF0aW5nKSB7CiAgICAgICAgc3luYyA9IGZhbHNlCiAgICAgICAgLy8gb25seSBhc3luYyB2YWxpZGF0ZSB0cmlnZ2VyIHZhbGlkYXRpbmcKICAgICAgICB0aGlzLiRlbWl0KEVWRU5UX1ZBTElEQVRJTkcpCiAgICAgICAgdGhpcy52YWxpZCA9IHVuZGVmaW5lZAogICAgICAgIHRoaXMuJGVtaXQoRVZFTlRfSU5QVVQsIHRoaXMudmFsaWQpCiAgICAgIH0KICAgIH0sCiAgICBfdXBkYXRlTW9kZWwodmFsaWQsIHJlc3VsdCkgewogICAgICB0aGlzLnZhbGlkYXRlZCA9IHRydWUKICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQKICAgICAgaWYgKHJlc3VsdC5yZXF1aXJlZCAmJiByZXN1bHQucmVxdWlyZWQuaW52YWxpZCkgewogICAgICAgIC8vIHJlcXVpcmVkCiAgICAgICAgdGhpcy5tc2cgPSByZXN1bHQucmVxdWlyZWQubWVzc2FnZQogICAgICB9CgogICAgICBpZiAodmFsaWQpIHsKICAgICAgICB0aGlzLm1zZyA9ICcnCiAgICAgIH0KICAgICAgdGhpcy52YWxpZCA9IHZhbGlkCiAgICAgIHRoaXMuJGVtaXQoRVZFTlRfSU5QVVQsIHRoaXMudmFsaWQpCiAgICB9LAogICAgcmVzZXQoKSB7CiAgICAgIHRoaXMuX3ZhbGlkYXRlQ291bnQrKwogICAgICB0aGlzLnZhbGlkYXRpbmcgPSBmYWxzZQogICAgICB0aGlzLmRpcnR5ID0gZmFsc2UKICAgICAgdGhpcy5yZXN1bHQgPSB7fQogICAgICB0aGlzLm1zZyA9ICcnCiAgICAgIHRoaXMudmFsaWRhdGVkID0gZmFsc2UKICAgICAgdGhpcy52YWxpZCA9IHVuZGVmaW5lZAogICAgICB0aGlzLiRlbWl0KEVWRU5UX0lOUFVULCB0aGlzLnZhbGlkKQogICAgfSwKICAgIG1zZ0NsaWNrSGFuZGxlcigpIHsKICAgICAgdGhpcy4kZW1pdChFVkVOVF9NU0dfQ0xJQ0spCiAgICB9LAogICAgZmluZE1lc3NhZ2UgKGtleSwgY29uZmlnLCB0eXBlLCB2YWwpIHsKICAgICAgY29uc3QgbWVzc2FnZXMgPSB0aGlzLiRjdWJlTWVzc2FnZXMKICAgICAgY29uc3QgbGFuZyA9IHRoaXMuJGN1YmVMYW5nCiAgICAgIGNvbnN0IE5BTUVTUEFDRSA9ICd2YWxpZGF0b3InCiAgICAgIGNvbnN0IHRhcmdldCA9IG1lc3NhZ2VzW2xhbmddW05BTUVTUEFDRV1ba2V5XQogICAgICBpZiAoIXRhcmdldCkgewogICAgICAgIHJldHVybiAnJwogICAgICB9CiAgICAgIGlmIChpc1N0cmluZyh0YXJnZXQpKSB7CiAgICAgICAgcmV0dXJuIHRhcmdldAogICAgICB9IGVsc2UgaWYgKGlzRnVuYyh0YXJnZXQpKSB7CiAgICAgICAgcmV0dXJuIHRhcmdldChjb25maWcpCiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKCF0YXJnZXRbdHlwZV0pIHsKICAgICAgICAgIHR5cGUgPSBpc0FycmF5KHZhbCkgPyAnYXJyYXknIDogdHlwZW9mIHZhbAogICAgICAgIH0KICAgICAgICByZXR1cm4gdHlwZW9mIHRhcmdldFt0eXBlXSA9PT0gJ2Z1bmN0aW9uJyA/IHRhcmdldFt0eXBlXShjb25maWcpIDogdGVtcGxhdGUodGFyZ2V0W3R5cGVdLCBjb25maWcpCiAgICAgIH0KICAgIH0KICB9Cn0K"},{"version":3,"sources":["validator.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAqBA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"validator.vue","sourceRoot":"node_modules/cube-ui/src/components/validator","sourcesContent":["<template>\n  <div class=\"cube-validator\" :class=\"containerClass\">\n    <div class=\"cube-validator-content\">\n      <slot></slot>\n    </div>\n    <div class=\"cube-validator-msg\" @click=\"msgClickHandler\">\n      <slot\n        name=\"message\"\n        :message=\"msg\"\n        :dirty=\"dirty\"\n        :validated=\"validated\"\n        :validating=\"validating\"\n        :result=\"result\"\n      >\n        <span class=\"cube-validator-msg-def\">{{ dirtyOrValidated ? msg : '' }}</span>\n      </slot>\n    </div>\n  </div>\n</template>\n\n<script type=\"text/ecmascript-6\">\n  import { parallel, cb2PromiseWithResolve, isUndef, isFunc, isString, isArray } from '../../common/helpers/util'\n  import { rules } from '../../common/helpers/validator'\n  import localeMixin from '../../common/mixins/locale'\n  import template from '../../common/helpers/string-template'\n\n  const COMPONENT_NAME = 'cube-validator'\n  const EVENT_INPUT = 'input'\n  const EVENT_VALIDATING = 'validating'\n  const EVENT_VALIDATED = 'validated'\n  const EVENT_MSG_CLICK = 'msg-click'\n\n  export default {\n    name: COMPONENT_NAME,\n    mixins: [localeMixin],\n    props: {\n      model: {\n        required: true\n      },\n      modelKey: {\n        type: String,\n        default: ''\n      },\n      rules: {\n        type: Object,\n        default() {\n          return {}\n        }\n      },\n      messages: {\n        type: [Object, String],\n        default() {\n          return {}\n        }\n      },\n      value: {},\n      disabled: {\n        type: Boolean,\n        default: false\n      },\n      immediate: {\n        type: Boolean,\n        default: false\n      }\n    },\n    data() {\n      return {\n        valid: this.value,\n        validated: false,\n        msg: '',\n        dirty: false,\n        validating: false,\n        result: {}\n      }\n    },\n    computed: {\n      targetModel() {\n        const modelKey = this.modelKey\n        const model = this.model\n        return modelKey ? model[modelKey] : model\n      },\n      invalid() {\n        const valid = this.valid\n        return isUndef(valid) ? undefined : !valid\n      },\n      isDisabled() {\n        const disabled = this.disabled\n        const noRules = Object.keys(this.rules).length <= 0\n        return disabled || noRules\n      },\n      dirtyOrValidated() {\n        return (this.dirty || this.validated) && !this.validating\n      },\n      containerClass() {\n        const disabled = this.isDisabled\n        if (disabled) {\n          return\n        }\n        return {\n          'cube-validator_invalid': this.invalid,\n          'cube-validator_valid': this.valid,\n          'cube-validator_validating': this.validating\n        }\n      }\n    },\n    watch: {\n      value(newVal) {\n        this.valid = newVal\n      },\n      targetModel: {\n        handler() {\n          if (this.isDisabled) {\n            return\n          }\n          if (!this.dirty) {\n            this.dirty = true\n          }\n\n          this.validate()\n        },\n        sync: true\n      },\n      rules() {\n        this.validate()\n      },\n      isDisabled(newVal) {\n        if (!newVal && this.trigger && !this.validated) {\n          this.validate()\n        }\n      }\n    },\n    created() {\n      this._validateCount = 0\n      if (!this.isDisabled && this.immediate) {\n        this.validate()\n      }\n    },\n    methods: {\n      validate(cb) {\n        const promise = cb2PromiseWithResolve(cb)\n        if (promise) {\n          cb = promise.resolve\n        }\n        if (this.isDisabled) {\n          cb && cb(this.valid)\n          return promise\n        }\n        this._validateCount++\n        const validateCount = this._validateCount\n        const val = this.targetModel\n\n        const configRules = this.rules\n        const type = configRules.type\n        const allTasks = []\n\n        let requiredValid = true\n        if (!configRules.required) {\n          // treat it as empty, no need to validate other rules\n          requiredValid = rules.required(val, true, type)\n        }\n\n        if (requiredValid) {\n          for (const key in configRules) {\n            const ruleValue = configRules[key]\n            let ret\n            if (isFunc(ruleValue)) {\n              ret = ruleValue(val, configRules[key], type)\n            } else {\n              ret = !rules[key] || rules[key](val, configRules[key], type)\n            }\n            allTasks.push((next) => {\n              const resolve = (_ret) => {\n                next({\n                  key: key,\n                  valid: _ret === true,\n                  ret: _ret\n                })\n              }\n              const reject = (err) => {\n                next({\n                  key: key,\n                  valid: false,\n                  ret: err\n                })\n              }\n              if (typeof ret === 'object' && isFunc(ret.then)) {\n                ret.then(resolve).catch(reject)\n              } else if (isFunc(ret)) {\n                ret(resolve, reject)\n              } else {\n                next({\n                  key: key,\n                  valid: ret === true,\n                  ret: ret\n                })\n              }\n            })\n          }\n        }\n        this._checkTasks(allTasks, validateCount, cb)\n        return promise\n      },\n      _checkTasks(allTasks, validateCount, cb) {\n        const configRules = this.rules\n        let isValid = true\n        const result = {}\n        let sync = true\n        this.validating = true\n        const model = this.targetModel\n        parallel(allTasks, (results) => {\n          if (this._validateCount !== validateCount) {\n            return\n          }\n          this.validating = false\n          results.forEach(({ key, valid, ret }) => {\n            const msg = this.messages[key]\n              ? isFunc(this.messages[key])\n                ? this.messages[key](ret, valid)\n                : this.messages[key]\n              : this.findMessage(key, configRules[key], configRules.type, model)\n            if (isValid && !valid) {\n              isValid = false\n              this.msg = msg\n            }\n            result[key] = {\n              valid: valid,\n              invalid: !valid,\n              message: msg\n            }\n          })\n          if (!sync) {\n            this.$emit(EVENT_VALIDATED, isValid)\n          }\n          this._updateModel(isValid, result)\n          cb && cb(this.valid)\n        })\n        if (this.validating) {\n          sync = false\n          // only async validate trigger validating\n          this.$emit(EVENT_VALIDATING)\n          this.valid = undefined\n          this.$emit(EVENT_INPUT, this.valid)\n        }\n      },\n      _updateModel(valid, result) {\n        this.validated = true\n        this.result = result\n        if (result.required && result.required.invalid) {\n          // required\n          this.msg = result.required.message\n        }\n\n        if (valid) {\n          this.msg = ''\n        }\n        this.valid = valid\n        this.$emit(EVENT_INPUT, this.valid)\n      },\n      reset() {\n        this._validateCount++\n        this.validating = false\n        this.dirty = false\n        this.result = {}\n        this.msg = ''\n        this.validated = false\n        this.valid = undefined\n        this.$emit(EVENT_INPUT, this.valid)\n      },\n      msgClickHandler() {\n        this.$emit(EVENT_MSG_CLICK)\n      },\n      findMessage (key, config, type, val) {\n        const messages = this.$cubeMessages\n        const lang = this.$cubeLang\n        const NAMESPACE = 'validator'\n        const target = messages[lang][NAMESPACE][key]\n        if (!target) {\n          return ''\n        }\n        if (isString(target)) {\n          return target\n        } else if (isFunc(target)) {\n          return target(config)\n        } else {\n          if (!target[type]) {\n            type = isArray(val) ? 'array' : typeof val\n          }\n          return typeof target[type] === 'function' ? target[type](config) : template(target[type], config)\n        }\n      }\n    }\n  }\n</script>\n\n<style lang=\"stylus\">\n  @require \"../../common/stylus/variable.styl\"\n\n  .cube-validator\n    .cube-checkbox, .cube-radio\n      color: inherit\n    .cube-input\n      input\n        color: inherit\n    .cube-textarea\n      color: inherit\n    .cube-select\n      color: inherit\n  .cube-validator-msg-def\n    font-size: $fontsize-medium\n    color: $validator-msg-def-color\n</style>\n"]}]}